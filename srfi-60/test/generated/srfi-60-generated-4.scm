(import (chibi) (chibi test) (srfi 60))

(test-begin "srfi-60/generated")

(test-begin "Bitwise Operations")

(test 0 (bitwise-and 8 -10))
(test 5 (bitwise-and 5 -3))
(test -16 (bitwise-and -2 -15))
(test 1 (bitwise-and -9 9))
(test 9 (bitwise-and 15 -7))
(test 4 (bitwise-and 4 5))
(test -10 (bitwise-and -9 -10))
(test -16 (bitwise-and -8 -11))
(test 0 (bitwise-and -10 1))
(test 10 (bitwise-and 10 -1))
(test 0 (bitwise-and 0 15))
(test 3 (bitwise-and -9 11))
(test 2 (bitwise-and -14 14))
(test -9 (bitwise-and -9 -9))
(test 2 (bitwise-and 11 -14))
(test 0 (bitwise-and 0 11))
(test 1 (bitwise-and 3 -15))
(test -15 (bitwise-and -15 -3))
(test 0 (bitwise-and 0 8))
(test 1 (bitwise-and -15 1))
(test -16 (bitwise-and -14 -11))
(test 8 (bitwise-and 8 15))
(test 6 (bitwise-and 6 -10))
(test -16 (bitwise-and -16 -15))
(test 0 (bitwise-and -10 1))
(test 2 (bitwise-and 7 2))
(test 0 (bitwise-and -12 2))
(test 9 (bitwise-and 15 -7))
(test -16 (bitwise-and -14 -16))
(test 16 (bitwise-and -1 16))
(test -16 (bitwise-and -16 -16))
(test 2 (bitwise-and -14 10))
(test 3 (bitwise-and -1 3))
(test 3 (bitwise-and -9 11))
(test 9 (bitwise-and 9 -1))
(test 1 (bitwise-and -13 9))
(test -14 (bitwise-and -14 -14))
(test 1 (bitwise-and 9 3))
(test -13 (bitwise-and -9 -5))
(test 8 (bitwise-and -8 9))
(test 0 (bitwise-and -15 0))
(test 0 (bitwise-and 0 -8))
(test 0 (bitwise-and 10 1))
(test 3 (bitwise-and -13 7))
(test -9 (bitwise-and -1 -9))
(test 1 (bitwise-and 1 13))
(test -15 (bitwise-and -9 -15))
(test 1 (bitwise-and 11 1))
(test -13 (bitwise-and -5 -13))
(test 0 (bitwise-and 9 -16))

(test -1 (bitwise-ior 9 -10))
(test -4 (bitwise-ior 12 -16))
(test -1 (bitwise-ior -9 11))
(test 13 (bitwise-ior 9 5))
(test 14 (bitwise-ior 4 10))
(test -5 (bitwise-ior -7 2))
(test -7 (bitwise-ior -8 -7))
(test -11 (bitwise-ior 4 -11))
(test -1 (bitwise-ior -2 11))
(test -11 (bitwise-ior -16 -11))
(test 7 (bitwise-ior 1 6))
(test 13 (bitwise-ior 9 13))
(test -1 (bitwise-ior -9 -2))
(test -1 (bitwise-ior -1 12))
(test 15 (bitwise-ior 11 13))
(test -11 (bitwise-ior -15 -11))
(test -4 (bitwise-ior 8 -12))
(test -5 (bitwise-ior -14 -7))
(test -1 (bitwise-ior -7 -10))
(test -1 (bitwise-ior -7 15))
(test 14 (bitwise-ior 14 12))
(test -1 (bitwise-ior 15 -12))
(test -9 (bitwise-ior -13 5))
(test -3 (bitwise-ior -4 -15))
(test 12 (bitwise-ior 12 8))
(test -1 (bitwise-ior 14 -5))
(test -3 (bitwise-ior 5 -8))
(test -2 (bitwise-ior -2 8))
(test 14 (bitwise-ior 6 14))
(test 6 (bitwise-ior 0 6))
(test -9 (bitwise-ior -10 5))
(test 21 (bitwise-ior 5 16))
(test -1 (bitwise-ior -9 11))
(test -4 (bitwise-ior 12 -4))
(test -1 (bitwise-ior 13 -5))
(test -3 (bitwise-ior 5 -4))
(test 15 (bitwise-ior 1 15))
(test -6 (bitwise-ior -8 10))
(test -1 (bitwise-ior -1 4))
(test 5 (bitwise-ior 5 4))
(test 10 (bitwise-ior 10 2))
(test -1 (bitwise-ior -9 8))
(test 11 (bitwise-ior 1 11))
(test 24 (bitwise-ior 16 8))
(test -3 (bitwise-ior 12 -7))
(test 13 (bitwise-ior 12 9))
(test -3 (bitwise-ior -3 16))
(test 3 (bitwise-ior 2 3))
(test 15 (bitwise-ior 15 4))
(test -12 (bitwise-ior -12 -16))

(test -5 (bitwise-xor 14 -11))
(test -2 (bitwise-xor -2 0))
(test -22 (bitwise-xor 16 -6))
(test -14 (bitwise-xor 10 -8))
(test 17 (bitwise-xor 16 1))
(test 15 (bitwise-xor 15 0))
(test -8 (bitwise-xor -16 8))
(test -15 (bitwise-xor 3 -14))
(test 11 (bitwise-xor -1 -12))
(test -10 (bitwise-xor -4 10))
(test -18 (bitwise-xor -2 16))
(test -15 (bitwise-xor -4 13))
(test -15 (bitwise-xor -11 4))
(test 2 (bitwise-xor -10 -12))
(test 5 (bitwise-xor 14 11))
(test -4 (bitwise-xor -9 11))
(test -31 (bitwise-xor -15 16))
(test 11 (bitwise-xor 3 8))
(test -6 (bitwise-xor 6 -4))
(test 21 (bitwise-xor 16 5))
(test 15 (bitwise-xor 7 8))
(test 0 (bitwise-xor 5 5))
(test 27 (bitwise-xor 16 11))
(test -15 (bitwise-xor 1 -16))
(test -29 (bitwise-xor -13 16))
(test 9 (bitwise-xor 3 10))
(test -10 (bitwise-xor 11 -3))
(test -10 (bitwise-xor 5 -13))
(test 15 (bitwise-xor 1 14))
(test -2 (bitwise-xor -1 1))
(test -15 (bitwise-xor 7 -10))
(test 5 (bitwise-xor -10 -13))
(test 0 (bitwise-xor 10 10))
(test -15 (bitwise-xor 7 -10))
(test -13 (bitwise-xor 10 -7))
(test -29 (bitwise-xor 16 -13))
(test 24 (bitwise-xor 16 8))
(test -9 (bitwise-xor 11 -4))
(test -13 (bitwise-xor -9 4))
(test -8 (bitwise-xor 7 -1))
(test 4 (bitwise-xor -16 -12))
(test 10 (bitwise-xor -15 -5))
(test 3 (bitwise-xor -4 -1))
(test 6 (bitwise-xor -2 -8))
(test -16 (bitwise-xor -15 1))
(test 5 (bitwise-xor -7 -4))
(test 4 (bitwise-xor 11 15))
(test 3 (bitwise-xor 15 12))
(test -3 (bitwise-xor -5 6))
(test 13 (bitwise-xor 2 15))

(test 4 (bitwise-not -5))
(test 6 (bitwise-not -7))
(test -17 (bitwise-not 16))
(test -6 (bitwise-not 5))
(test 4 (bitwise-not -5))
(test 1 (bitwise-not -2))
(test 13 (bitwise-not -14))
(test 9 (bitwise-not -10))
(test 9 (bitwise-not -10))
(test -8 (bitwise-not 7))
(test 5 (bitwise-not -6))
(test 0 (bitwise-not -1))
(test 10 (bitwise-not -11))
(test -13 (bitwise-not 12))
(test -15 (bitwise-not 14))
(test -6 (bitwise-not 5))
(test 11 (bitwise-not -12))
(test 9 (bitwise-not -10))
(test -1 (bitwise-not 0))
(test -5 (bitwise-not 4))
(test 4 (bitwise-not -5))
(test -8 (bitwise-not 7))
(test -14 (bitwise-not 13))
(test -6 (bitwise-not 5))
(test 13 (bitwise-not -14))
(test 0 (bitwise-not -1))
(test 9 (bitwise-not -10))
(test -16 (bitwise-not 15))
(test -13 (bitwise-not 12))
(test -3 (bitwise-not 2))
(test 13 (bitwise-not -14))
(test 11 (bitwise-not -12))
(test 0 (bitwise-not -1))
(test -11 (bitwise-not 10))
(test -4 (bitwise-not 3))
(test 9 (bitwise-not -10))
(test 4 (bitwise-not -5))
(test -7 (bitwise-not 6))
(test 6 (bitwise-not -7))
(test -14 (bitwise-not 13))
(test -16 (bitwise-not 15))
(test 3 (bitwise-not -4))
(test -12 (bitwise-not 11))
(test 2 (bitwise-not -3))
(test 5 (bitwise-not -6))
(test 15 (bitwise-not -16))
(test -5 (bitwise-not 4))
(test -15 (bitwise-not 14))
(test -13 (bitwise-not 12))
(test 9 (bitwise-not -10))

(test -12 (bitwise-if 11 4 -4))
(test 9 (bitwise-if 15 -7 10))
(test -10 (bitwise-if -3 -10 -9))
(test -8 (bitwise-if 3 0 -6))
(test -7 (bitwise-if 8 13 -7))
(test 9 (bitwise-if -3 11 1))
(test 4 (bitwise-if -13 8 -10))
(test -3 (bitwise-if -2 -3 -11))
(test 1 (bitwise-if -11 9 5))
(test 3 (bitwise-if -12 9 3))
(test 0 (bitwise-if 9 16 1))
(test -1 (bitwise-if 4 -2 -1))
(test -8 (bitwise-if -5 -4 -6))
(test 6 (bitwise-if 1 -16 7))
(test 8 (bitwise-if -3 8 -12))
(test 0 (bitwise-if 2 8 2))
(test 12 (bitwise-if -11 14 8))
(test -7 (bitwise-if -8 -5 9))
(test -7 (bitwise-if -6 -7 3))
(test -11 (bitwise-if -10 -4 1))
(test -13 (bitwise-if -8 -11 -13))
(test 8 (bitwise-if -9 0 -6))
(test 13 (bitwise-if -15 1 -3))
(test 2 (bitwise-if -7 2 2))
(test 6 (bitwise-if 11 6 4))
(test 7 (bitwise-if -5 7 -9))
(test -7 (bitwise-if 1 9 -7))
(test 1 (bitwise-if 10 16 1))
(test 11 (bitwise-if 9 -3 10))
(test 10 (bitwise-if 15 -6 12))
(test -11 (bitwise-if -8 -13 5))
(test -12 (bitwise-if 11 -12 -12))
(test 13 (bitwise-if 11 -7 7))
(test 0 (bitwise-if 16 6 16))
(test -8 (bitwise-if 5 0 -4))
(test -9 (bitwise-if -12 -9 -13))
(test -10 (bitwise-if 2 6 -10))
(test 10 (bitwise-if 8 11 10))
(test 14 (bitwise-if -10 7 -8))
(test 3 (bitwise-if 2 -10 3))
(test -10 (bitwise-if 3 -10 -10))
(test -6 (bitwise-if -6 -1 10))
(test -6 (bitwise-if 0 9 -6))
(test 5 (bitwise-if -8 2 -3))
(test -15 (bitwise-if 4 -7 -11))
(test -6 (bitwise-if -8 -4 -6))
(test -15 (bitwise-if -4 -16 -7))
(test 11 (bitwise-if 14 11 5))
(test -7 (bitwise-if 6 0 -5))
(test -7 (bitwise-if -5 -7 -15))

(test #t (any-bits-set? 6 -3))
(test #t (any-bits-set? 10 2))
(test #f (any-bits-set? -12 9))
(test #f (any-bits-set? 8 4))
(test #f (any-bits-set? -14 0))
(test #t (any-bits-set? -9 -14))
(test #f (any-bits-set? 10 4))
(test #f (any-bits-set? 10 -15))
(test #t (any-bits-set? 2 11))
(test #f (any-bits-set? -12 10))
(test #t (any-bits-set? 3 -14))
(test #t (any-bits-set? -13 1))
(test #f (any-bits-set? 2 -3))
(test #t (any-bits-set? -12 -1))
(test #f (any-bits-set? 3 4))
(test #f (any-bits-set? 9 4))
(test #f (any-bits-set? 4 16))
(test #t (any-bits-set? -11 -7))
(test #t (any-bits-set? -16 -5))
(test #t (any-bits-set? -1 -12))
(test #f (any-bits-set? 16 11))
(test #t (any-bits-set? -2 -11))
(test #t (any-bits-set? -3 7))
(test #f (any-bits-set? 16 4))
(test #t (any-bits-set? 1 -13))
(test #t (any-bits-set? 16 -13))
(test #f (any-bits-set? -4 0))
(test #t (any-bits-set? 8 -8))
(test #t (any-bits-set? -9 7))
(test #t (any-bits-set? 7 -11))
(test #t (any-bits-set? -14 -11))
(test #t (any-bits-set? -12 13))
(test #t (any-bits-set? 6 -5))
(test #t (any-bits-set? -3 -12))
(test #f (any-bits-set? 8 3))
(test #t (any-bits-set? -16 -7))
(test #t (any-bits-set? 7 -2))
(test #t (any-bits-set? 14 -8))
(test #t (any-bits-set? 11 5))
(test #f (any-bits-set? 10 -15))
(test #t (any-bits-set? -7 -1))
(test #t (any-bits-set? 3 -3))
(test #f (any-bits-set? 4 16))
(test #t (any-bits-set? 14 -12))
(test #t (any-bits-set? 15 -14))
(test #f (any-bits-set? 8 6))
(test #t (any-bits-set? -10 2))
(test #t (any-bits-set? -14 -8))
(test #f (any-bits-set? 5 16))
(test #t (any-bits-set? -2 4))

(test-end)

(test-begin "Integer Properties")

(test 2 (bit-count -7))
(test 2 (bit-count 10))
(test 1 (bit-count 8))
(test 4 (bit-count 15))
(test 2 (bit-count 10))
(test 2 (bit-count 12))
(test 2 (bit-count 9))
(test 3 (bit-count -14))
(test 1 (bit-count 2))
(test 3 (bit-count 13))
(test 0 (bit-count -1))
(test 4 (bit-count -16))
(test 2 (bit-count -13))
(test 1 (bit-count 4))
(test 2 (bit-count -11))
(test 2 (bit-count 9))
(test 3 (bit-count -12))
(test 2 (bit-count -11))
(test 2 (bit-count -4))
(test 3 (bit-count 13))
(test 2 (bit-count -11))
(test 1 (bit-count -2))
(test 1 (bit-count 2))
(test 2 (bit-count -4))
(test 3 (bit-count 7))
(test 1 (bit-count -3))
(test 4 (bit-count 15))
(test 1 (bit-count -2))
(test 1 (bit-count 4))
(test 2 (bit-count 5))
(test 1 (bit-count 2))
(test 0 (bit-count 0))
(test 3 (bit-count 14))
(test 2 (bit-count -6))
(test 2 (bit-count 3))
(test 1 (bit-count 16))
(test 3 (bit-count 14))
(test 2 (bit-count 12))
(test 2 (bit-count -11))
(test 1 (bit-count 2))
(test 3 (bit-count -8))
(test 2 (bit-count 3))
(test 2 (bit-count 12))
(test 2 (bit-count -11))
(test 2 (bit-count -10))
(test 2 (bit-count -11))
(test 1 (bit-count -2))
(test 3 (bit-count 11))
(test 1 (bit-count -2))
(test 1 (bit-count -9))

(test 3 (integer-length -5))
(test 4 (integer-length -10))
(test 4 (integer-length 12))
(test 3 (integer-length 6))
(test 4 (integer-length -15))
(test 4 (integer-length -16))
(test 4 (integer-length 15))
(test 4 (integer-length -13))
(test 4 (integer-length 14))
(test 5 (integer-length 16))
(test 1 (integer-length 1))
(test 4 (integer-length 13))
(test 4 (integer-length 11))
(test 2 (integer-length -3))
(test 4 (integer-length -14))
(test 4 (integer-length -14))
(test 4 (integer-length 13))
(test 4 (integer-length 13))
(test 3 (integer-length -7))
(test 3 (integer-length -5))
(test 4 (integer-length -12))
(test 3 (integer-length -5))
(test 3 (integer-length -7))
(test 2 (integer-length 3))
(test 4 (integer-length -15))
(test 4 (integer-length 11))
(test 3 (integer-length 6))
(test 4 (integer-length 14))
(test 4 (integer-length 8))
(test 2 (integer-length -4))
(test 3 (integer-length -6))
(test 2 (integer-length 3))
(test 4 (integer-length 12))
(test 3 (integer-length 4))
(test 2 (integer-length 3))
(test 3 (integer-length 6))
(test 4 (integer-length -16))
(test 3 (integer-length 5))
(test 4 (integer-length -11))
(test 4 (integer-length -12))
(test 4 (integer-length -15))
(test 4 (integer-length -13))
(test 3 (integer-length 4))
(test 3 (integer-length 5))
(test 2 (integer-length -4))
(test 3 (integer-length -6))
(test 4 (integer-length 12))
(test 2 (integer-length -4))
(test 0 (integer-length -1))
(test 3 (integer-length 7))

(test 2 (first-set-bit -12))
(test 3 (first-set-bit 8))
(test 4 (first-set-bit -16))
(test 0 (first-set-bit -1))
(test 0 (first-set-bit -7))
(test 1 (first-set-bit -2))
(test 0 (first-set-bit -3))
(test 0 (first-set-bit 1))
(test 0 (first-set-bit 7))
(test 1 (first-set-bit 2))
(test 0 (first-set-bit -3))
(test 0 (first-set-bit -7))
(test 0 (first-set-bit -5))
(test 1 (first-set-bit 6))
(test 2 (first-set-bit 4))
(test 3 (first-set-bit -8))
(test 0 (first-set-bit 11))
(test 3 (first-set-bit -8))
(test 2 (first-set-bit -12))
(test 3 (first-set-bit -8))
(test 3 (first-set-bit 8))
(test 2 (first-set-bit 12))
(test 3 (first-set-bit 8))
(test 0 (first-set-bit 3))
(test 2 (first-set-bit 12))
(test 4 (first-set-bit -16))
(test 0 (first-set-bit -11))
(test 0 (first-set-bit -15))
(test 0 (first-set-bit 7))
(test 0 (first-set-bit 3))
(test 0 (first-set-bit 9))
(test 0 (first-set-bit 3))
(test 1 (first-set-bit -2))
(test 0 (first-set-bit -7))
(test 0 (first-set-bit -5))
(test 0 (first-set-bit 1))
(test 1 (first-set-bit 10))
(test 0 (first-set-bit 7))
(test 3 (first-set-bit 8))
(test 0 (first-set-bit -13))
(test 0 (first-set-bit -11))
(test 0 (first-set-bit 9))
(test 0 (first-set-bit -7))
(test 1 (first-set-bit -10))
(test 1 (first-set-bit -2))
(test 0 (first-set-bit 15))
(test 0 (first-set-bit -11))
(test 0 (first-set-bit 7))
(test 0 (first-set-bit 3))
(test 1 (first-set-bit 14))

(test-end)

(test-begin "Bit Within Word")

(test #t (bit-set? 1 -14))
(test #t (bit-set? 1 6))
(test #t (bit-set? 0 9))
(test #t (bit-set? 2 14))
(test #f (bit-set? 2 1))
(test #f (bit-set? 1 9))
(test #f (bit-set? 3 4))
(test #t (bit-set? 2 6))
(test #f (bit-set? 3 16))
(test #f (bit-set? 0 -16))
(test #f (bit-set? 3 6))
(test #t (bit-set? 3 -2))
(test #f (bit-set? 3 -11))
(test #f (bit-set? 2 -14))
(test #f (bit-set? 3 3))
(test #t (bit-set? 3 14))
(test #f (bit-set? 0 -2))
(test #t (bit-set? 1 6))
(test #t (bit-set? 2 -10))
(test #t (bit-set? 2 -11))
(test #t (bit-set? 2 4))
(test #t (bit-set? 0 -3))
(test #t (bit-set? 0 -7))
(test #t (bit-set? 1 11))
(test #t (bit-set? 2 -3))
(test #t (bit-set? 3 -2))
(test #t (bit-set? 1 -10))
(test #t (bit-set? 0 1))
(test #t (bit-set? 1 11))
(test #f (bit-set? 1 -8))
(test #t (bit-set? 2 12))
(test #t (bit-set? 3 -3))
(test #t (bit-set? 0 -3))
(test #f (bit-set? 3 -14))
(test #t (bit-set? 0 3))
(test #t (bit-set? 0 7))
(test #t (bit-set? 2 -2))
(test #t (bit-set? 0 1))
(test #f (bit-set? 0 6))
(test #t (bit-set? 1 10))
(test #f (bit-set? 2 11))
(test #t (bit-set? 2 -1))
(test #f (bit-set? 1 -8))
(test #f (bit-set? 3 -15))
(test #f (bit-set? 3 -16))
(test #t (bit-set? 3 10))
(test #t (bit-set? 1 3))
(test #f (bit-set? 2 1))
(test #f (bit-set? 2 3))
(test #t (bit-set? 1 -5))

(test 1 (copy-bit 0 1 #t))
(test -2 (copy-bit 3 -10 #t))
(test -16 (copy-bit 1 -14 #f))
(test -1 (copy-bit 1 -1 #t))
(test 20 (copy-bit 2 16 #t))
(test -13 (copy-bit 1 -13 #t))
(test -10 (copy-bit 3 -2 #f))
(test -2 (copy-bit 3 -10 #t))
(test 5 (copy-bit 3 5 #f))
(test -8 (copy-bit 2 -8 #f))
(test 7 (copy-bit 3 15 #f))
(test -16 (copy-bit 0 -15 #f))
(test 13 (copy-bit 2 9 #t))
(test -6 (copy-bit 1 -8 #t))
(test 4 (copy-bit 1 6 #f))
(test 7 (copy-bit 2 7 #t))
(test -3 (copy-bit 1 -1 #f))
(test -10 (copy-bit 2 -14 #t))
(test 16 (copy-bit 0 16 #f))
(test 4 (copy-bit 2 4 #t))
(test 6 (copy-bit 2 6 #t))
(test 2 (copy-bit 0 2 #f))
(test 1 (copy-bit 1 1 #f))
(test 6 (copy-bit 0 6 #f))
(test 15 (copy-bit 1 15 #t))
(test 11 (copy-bit 3 3 #t))
(test 20 (copy-bit 2 16 #t))
(test -5 (copy-bit 0 -5 #t))
(test 14 (copy-bit 1 14 #t))
(test 9 (copy-bit 0 8 #t))
(test 5 (copy-bit 1 5 #f))
(test -9 (copy-bit 0 -10 #t))
(test -8 (copy-bit 1 -8 #f))
(test -16 (copy-bit 2 -12 #f))
(test -12 (copy-bit 0 -11 #f))
(test -3 (copy-bit 0 -3 #t))
(test -2 (copy-bit 1 -4 #t))
(test 7 (copy-bit 2 3 #t))
(test 13 (copy-bit 1 15 #f))
(test 8 (copy-bit 1 10 #f))
(test -16 (copy-bit 1 -16 #f))
(test -6 (copy-bit 2 -2 #f))
(test 14 (copy-bit 0 14 #f))
(test 8 (copy-bit 3 8 #t))
(test 16 (copy-bit 0 16 #f))
(test -5 (copy-bit 3 -13 #t))
(test 1 (copy-bit 1 3 #f))
(test -10 (copy-bit 3 -10 #f))
(test -2 (copy-bit 3 -2 #t))
(test -12 (copy-bit 0 -12 #f))

(test-end)

(test-begin "Field of Bits")

(test 1 (bit-field -5 1 3))
(test 1 (bit-field 15 2 3))
(test 1 (bit-field -14 1 2))
(test 1 (bit-field 13 0 2))
(test 0 (bit-field -15 1 3))
(test 0 (bit-field 11 2 2))
(test 0 (bit-field 1 2 2))
(test 1 (bit-field -4 2 3))
(test 3 (bit-field -9 1 3))
(test 1 (bit-field -6 1 2))
(test 1 (bit-field 4 2 3))
(test 0 (bit-field 2 2 2))
(test 1 (bit-field 5 2 3))
(test 0 (bit-field -16 2 3))
(test 0 (bit-field -3 2 2))
(test 2 (bit-field -10 0 2))
(test 0 (bit-field 5 1 2))
(test 3 (bit-field 15 1 3))
(test 0 (bit-field -12 2 2))
(test 0 (bit-field -4 0 2))
(test 1 (bit-field 11 1 3))
(test 0 (bit-field -12 1 2))
(test 0 (bit-field 3 2 3))
(test 0 (bit-field 1 1 3))
(test 1 (bit-field -11 2 3))
(test 4 (bit-field -12 0 3))
(test 1 (bit-field 14 1 2))
(test 1 (bit-field -14 1 3))
(test 5 (bit-field -3 0 3))
(test 0 (bit-field 16 0 3))
(test 3 (bit-field -9 0 2))
(test 0 (bit-field -16 1 2))
(test 0 (bit-field -3 1 2))
(test 7 (bit-field 7 0 3))
(test 0 (bit-field 0 0 3))
(test 0 (bit-field 0 0 3))
(test 0 (bit-field 0 1 3))
(test 1 (bit-field 5 0 2))
(test 1 (bit-field -1 1 2))
(test 2 (bit-field 5 1 3))
(test 0 (bit-field 1 2 2))
(test 0 (bit-field 8 2 3))
(test 6 (bit-field -2 0 3))
(test 0 (bit-field -4 1 2))
(test 6 (bit-field -10 0 3))
(test 0 (bit-field 1 2 3))
(test 4 (bit-field -12 0 3))
(test 3 (bit-field -13 0 2))
(test 1 (bit-field -9 1 2))
(test 2 (bit-field 6 0 2))

(test -11 (copy-bit-field -11 6 1 2))
(test -14 (copy-bit-field -15 14 0 2))
(test 4 (copy-bit-field 5 4 0 2))
(test 13 (copy-bit-field 8 5 0 3))
(test -4 (copy-bit-field -8 -11 2 3))
(test 11 (copy-bit-field 11 12 2 2))
(test 14 (copy-bit-field 12 1 1 2))
(test 5 (copy-bit-field 3 6 1 3))
(test -10 (copy-bit-field -15 -10 0 3))
(test -14 (copy-bit-field -16 -3 1 2))
(test 14 (copy-bit-field 14 2 2 2))
(test -8 (copy-bit-field -8 -8 0 2))
(test -10 (copy-bit-field -10 -10 0 2))
(test 7 (copy-bit-field 7 2 2 2))
(test -3 (copy-bit-field -3 13 0 3))
(test 11 (copy-bit-field 11 -15 2 2))
(test -5 (copy-bit-field -7 -11 1 3))
(test -3 (copy-bit-field -1 -11 0 3))
(test 4 (copy-bit-field 4 -3 2 2))
(test 10 (copy-bit-field 12 -7 1 3))
(test -7 (copy-bit-field -5 8 1 3))
(test 0 (copy-bit-field 0 16 0 2))
(test 1 (copy-bit-field 1 -8 1 3))
(test 9 (copy-bit-field 15 1 0 3))
(test 0 (copy-bit-field 0 -4 1 2))
(test 7 (copy-bit-field 2 7 0 3))
(test -12 (copy-bit-field -12 -8 2 2))
(test -11 (copy-bit-field -16 13 0 3))
(test 10 (copy-bit-field 10 5 1 2))
(test -3 (copy-bit-field -4 -11 0 3))
(test -2 (copy-bit-field -2 0 2 2))
(test -2 (copy-bit-field -8 3 1 3))
(test 8 (copy-bit-field 9 0 0 2))
(test 11 (copy-bit-field 9 3 0 3))
(test -2 (copy-bit-field -4 14 0 2))
(test -13 (copy-bit-field -11 9 1 3))
(test 2 (copy-bit-field 0 7 1 2))
(test 4 (copy-bit-field 5 -16 0 2))
(test -13 (copy-bit-field -15 13 1 3))
(test -14 (copy-bit-field -16 15 1 2))
(test 7 (copy-bit-field 7 2 2 2))
(test 7 (copy-bit-field 5 15 1 3))
(test -3 (copy-bit-field -3 -11 2 3))
(test 0 (copy-bit-field 4 -6 2 3))
(test 14 (copy-bit-field 10 -2 0 3))
(test -6 (copy-bit-field -4 13 1 3))
(test -4 (copy-bit-field -4 -15 2 2))
(test 8 (copy-bit-field 14 -16 0 3))
(test 15 (copy-bit-field 14 -9 0 3))
(test 2 (copy-bit-field 2 14 0 2))

(test -1024 (arithmetic-shift -16 6))
(test -72 (arithmetic-shift -9 3))
(test -15 (arithmetic-shift -15 0))
(test -14 (arithmetic-shift -7 1))
(test 192 (arithmetic-shift 3 6))
(test 0 (arithmetic-shift 10 -4))
(test 0 (arithmetic-shift 15 -4))
(test -1 (arithmetic-shift -1 -1))
(test 9 (arithmetic-shift 9 0))
(test 1 (arithmetic-shift 8 -3))
(test -1 (arithmetic-shift -8 -5))
(test 160 (arithmetic-shift 10 4))
(test -1 (arithmetic-shift -4 -2))
(test 32 (arithmetic-shift 8 2))
(test -56 (arithmetic-shift -14 2))
(test -3 (arithmetic-shift -10 -2))
(test -1 (arithmetic-shift -4 -2))
(test 20 (arithmetic-shift 10 1))
(test -1 (arithmetic-shift -1 -2))
(test -18 (arithmetic-shift -9 1))
(test 1 (arithmetic-shift 7 -2))
(test -1 (arithmetic-shift -1 -6))
(test -448 (arithmetic-shift -14 5))
(test -224 (arithmetic-shift -14 4))
(test -1 (arithmetic-shift -8 -5))
(test -20 (arithmetic-shift -5 2))
(test -1 (arithmetic-shift -7 -5))
(test -2 (arithmetic-shift -6 -2))
(test 0 (arithmetic-shift 1 -4))
(test 28 (arithmetic-shift 14 1))
(test 8 (arithmetic-shift 8 0))
(test -64 (arithmetic-shift -2 5))
(test 22 (arithmetic-shift 11 1))
(test -48 (arithmetic-shift -6 3))
(test -8 (arithmetic-shift -16 -1))
(test 1 (arithmetic-shift 5 -2))
(test 0 (arithmetic-shift 8 -5))
(test 0 (arithmetic-shift 14 -5))
(test -4 (arithmetic-shift -16 -2))
(test -20 (arithmetic-shift -5 2))
(test 288 (arithmetic-shift 9 5))
(test 4 (arithmetic-shift 9 -1))
(test -4 (arithmetic-shift -4 0))
(test 0 (arithmetic-shift 4 -3))
(test -208 (arithmetic-shift -13 4))
(test 20 (arithmetic-shift 10 1))
(test 0 (arithmetic-shift 11 -4))
(test 2 (arithmetic-shift 9 -2))
(test 0 (arithmetic-shift 6 -5))
(test 0 (arithmetic-shift 1 -2))

(test -3 (rotate-bit-field -3 -6 0 3))
(test 8 (rotate-bit-field 8 4 1 3))
(test 2 (rotate-bit-field 2 4 1 3))
(test 3 (rotate-bit-field 3 -2 1 2))
(test -16 (rotate-bit-field -16 -1 2 2))
(test 14 (rotate-bit-field 14 6 2 2))
(test 0 (rotate-bit-field 0 5 0 2))
(test 15 (rotate-bit-field 15 3 0 2))
(test -8 (rotate-bit-field -8 4 1 3))
(test 2 (rotate-bit-field 2 0 2 3))
(test -5 (rotate-bit-field -5 -6 2 3))
(test -13 (rotate-bit-field -13 -2 0 2))
(test 3 (rotate-bit-field 3 -5 1 2))
(test -12 (rotate-bit-field -12 -4 1 2))
(test -4 (rotate-bit-field -7 5 0 3))
(test -11 (rotate-bit-field -13 -3 1 3))
(test -14 (rotate-bit-field -14 0 1 3))
(test -10 (rotate-bit-field -11 3 0 2))
(test -4 (rotate-bit-field -6 -5 0 3))
(test -6 (rotate-bit-field -6 6 2 2))
(test -2 (rotate-bit-field -3 -4 0 3))
(test 12 (rotate-bit-field 12 -4 2 3))
(test -8 (rotate-bit-field -8 3 0 2))
(test 5 (rotate-bit-field 5 -6 0 2))
(test -1 (rotate-bit-field -1 5 0 2))
(test 10 (rotate-bit-field 9 -2 0 3))
(test -5 (rotate-bit-field -5 -6 1 3))
(test -12 (rotate-bit-field -12 -1 1 2))
(test -5 (rotate-bit-field -5 1 0 2))
(test 7 (rotate-bit-field 7 2 0 2))
(test 2 (rotate-bit-field 2 -2 1 3))
(test -6 (rotate-bit-field -6 0 0 2))
(test -5 (rotate-bit-field -5 -1 2 2))
(test -5 (rotate-bit-field -5 4 2 2))
(test 13 (rotate-bit-field 11 -1 0 3))
(test -2 (rotate-bit-field -2 -2 1 3))
(test -4 (rotate-bit-field -4 0 2 2))
(test -15 (rotate-bit-field -15 0 2 3))
(test -15 (rotate-bit-field -15 -6 2 2))
(test -4 (rotate-bit-field -6 -3 1 3))
(test -14 (rotate-bit-field -12 1 1 3))
(test -15 (rotate-bit-field -15 4 2 3))
(test -4 (rotate-bit-field -4 -2 0 2))
(test 9 (rotate-bit-field 12 -2 0 3))
(test 15 (rotate-bit-field 15 3 2 2))
(test -12 (rotate-bit-field -15 2 0 3))
(test 4 (rotate-bit-field 4 1 1 2))
(test 8 (rotate-bit-field 8 -1 1 2))
(test -9 (rotate-bit-field -9 2 2 2))
(test 16 (rotate-bit-field 16 6 1 2))

(test -13 (reverse-bit-field -13 2 3))
(test 7 (reverse-bit-field 7 0 2))
(test 7 (reverse-bit-field 7 0 3))
(test 13 (reverse-bit-field 13 0 3))
(test -12 (reverse-bit-field -12 2 2))
(test -6 (reverse-bit-field -4 1 3))
(test -4 (reverse-bit-field -4 0 2))
(test -5 (reverse-bit-field -3 1 3))
(test 16 (reverse-bit-field 16 1 2))
(test -1 (reverse-bit-field -1 1 3))
(test 7 (reverse-bit-field 7 2 3))
(test -10 (reverse-bit-field -13 0 3))
(test -10 (reverse-bit-field -10 1 3))
(test -1 (reverse-bit-field -1 2 2))
(test -9 (reverse-bit-field -9 2 2))
(test 2 (reverse-bit-field 2 2 2))
(test -15 (reverse-bit-field -15 2 2))
(test 8 (reverse-bit-field 8 1 2))
(test 9 (reverse-bit-field 9 1 2))
(test -8 (reverse-bit-field -8 0 3))
(test -15 (reverse-bit-field -15 2 2))
(test 12 (reverse-bit-field 12 0 2))
(test 10 (reverse-bit-field 9 0 2))
(test -8 (reverse-bit-field -8 1 2))
(test -13 (reverse-bit-field -13 1 2))
(test 15 (reverse-bit-field 15 2 2))
(test -15 (reverse-bit-field -14 0 2))
(test 11 (reverse-bit-field 11 2 3))
(test 11 (reverse-bit-field 11 0 2))
(test -13 (reverse-bit-field -13 1 2))
(test 15 (reverse-bit-field 15 0 2))
(test -2 (reverse-bit-field -2 2 2))
(test -1 (reverse-bit-field -1 1 3))
(test -10 (reverse-bit-field -10 1 2))
(test 2 (reverse-bit-field 4 1 3))
(test 0 (reverse-bit-field 0 0 3))
(test -14 (reverse-bit-field -12 1 3))
(test 2 (reverse-bit-field 2 1 2))
(test 5 (reverse-bit-field 5 1 2))
(test 13 (reverse-bit-field 13 0 3))
(test -1 (reverse-bit-field -1 2 2))
(test -15 (reverse-bit-field -15 1 2))
(test -12 (reverse-bit-field -14 1 3))
(test -16 (reverse-bit-field -16 2 3))
(test 13 (reverse-bit-field 13 1 2))
(test 6 (reverse-bit-field 3 0 3))
(test -8 (reverse-bit-field -8 1 2))
(test 1 (reverse-bit-field 4 0 3))
(test 8 (reverse-bit-field 8 2 2))
(test -10 (reverse-bit-field -10 1 3))

(test-end)

(test-begin "Bits as Booleans")

(test '(#f #t) (integer->list 5 2))
(test '(#f #f #f #t #t #f #f) (integer->list 12 7))
(test '(#f #t #f #f #f) (integer->list 8 5))
(test '(#f #t #t) (integer->list 11 3))
(test '(#f #f #t #t #t #t) (integer->list 15 6))
(test '(#f #f) (integer->list 8 2))
(test '(#t) (integer->list 7 1))
(test '(#f) (integer->list 0 1))
(test '(#f #t #f #f #t) (integer->list 9 5))
(test '() (integer->list 11 0))
(test '(#f #f #t #f #f #t) (integer->list 9 6))
(test '(#f #t #t #f #t) (integer->list 13 5))
(test '(#f #t) (integer->list 9 2))
(test '(#t) (integer->list 15 1))
(test '() (integer->list 14 0))
(test '(#f #f #f #t #f #f) (integer->list 4 6))
(test '() (integer->list 12 0))
(test '(#t #f #f #t) (integer->list 9 4))
(test '(#f #f #f #f #t #f #t) (integer->list 5 7))
(test '(#f #f #f #t #f #t) (integer->list 5 6))
(test '(#f #f #t #f #f) (integer->list 4 5))
(test '(#f #f #f #f #f #t #t) (integer->list 3 7))
(test '(#f #f #f #t #f #f) (integer->list 4 6))
(test '(#f) (integer->list 6 1))
(test '() (integer->list 14 0))
(test '(#f) (integer->list 8 1))
(test '(#f #f #f #f) (integer->list 16 4))
(test '(#t) (integer->list 13 1))
(test '() (integer->list 0 0))
(test '(#f #f #f #f #f) (integer->list 0 5))
(test '(#f #f #f #t) (integer->list 1 4))
(test '(#f #t #f #t #t) (integer->list 11 5))
(test '(#f #t #t #f #t) (integer->list 13 5))
(test '(#t #t #f #t) (integer->list 13 4))
(test '(#t #t #t #f) (integer->list 14 4))
(test '(#t) (integer->list 9 1))
(test '(#f #f #f #t #t #t #t) (integer->list 15 7))
(test '(#f #t #f #f) (integer->list 4 4))
(test '(#f #t #t #f #f) (integer->list 12 5))
(test '(#f #f) (integer->list 4 2))
(test '(#f #t #f #t #t) (integer->list 11 5))
(test '(#f #f #f #f #f #f #t) (integer->list 1 7))
(test '(#t #f #t #t) (integer->list 11 4))
(test '(#f #t #f) (integer->list 2 3))
(test '(#f #f) (integer->list 16 2))
(test '(#f #t #t) (integer->list 3 3))
(test '(#f) (integer->list 2 1))
(test '(#f #t #f #t #f) (integer->list 10 5))
(test '(#f #f #f #f #f #t #f) (integer->list 2 7))
(test '() (integer->list 11 0))

(test 3 (list->integer '(#t #t)))
(test 0 (list->integer '(#f)))
(test 0 (list->integer '()))
(test 1 (list->integer '(#t)))
(test 3 (list->integer '(#t #t)))
(test 0 (list->integer '()))
(test 7 (list->integer '(#t #t #t)))
(test 0 (list->integer '()))
(test 0 (list->integer '(#f)))
(test 3 (list->integer '(#t #t)))
(test 0 (list->integer '()))
(test 1 (list->integer '(#f #t)))
(test 1 (list->integer '(#t)))
(test 2 (list->integer '(#t #f)))
(test 1 (list->integer '(#t)))
(test 6 (list->integer '(#t #t #f)))
(test 1 (list->integer '(#f #t)))
(test 2 (list->integer '(#t #f)))
(test 1 (list->integer '(#f #f #t)))
(test 0 (list->integer '()))
(test 0 (list->integer '()))
(test 1 (list->integer '(#f #t)))
(test 2 (list->integer '(#t #f)))
(test 1 (list->integer '(#f #t)))
(test 1 (list->integer '(#f #t)))
(test 0 (list->integer '()))
(test 4 (list->integer '(#t #f #f)))
(test 1 (list->integer '(#f #t)))
(test 5 (list->integer '(#t #f #t)))
(test 1 (list->integer '(#t)))
(test 0 (list->integer '()))
(test 2 (list->integer '(#t #f)))
(test 1 (list->integer '(#f #f #t)))
(test 1 (list->integer '(#t)))
(test 0 (list->integer '()))
(test 1 (list->integer '(#t)))
(test 1 (list->integer '(#t)))
(test 6 (list->integer '(#t #t #f)))
(test 0 (list->integer '(#f)))
(test 6 (list->integer '(#t #t #f)))
(test 0 (list->integer '()))
(test 2 (list->integer '(#f #t #f)))
(test 0 (list->integer '(#f)))
(test 5 (list->integer '(#t #f #t)))
(test 3 (list->integer '(#t #t)))
(test 0 (list->integer '()))
(test 2 (list->integer '(#t #f)))
(test 0 (list->integer '(#f #f)))
(test 4 (list->integer '(#t #f #f)))
(test 0 (list->integer '()))

(test-end)

(test-end)

(test-exit)
